<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Graduation Projects Doctors</title>
    <link rel="stylesheet" href="CSS/Main CSS/Main.css" />
    <link rel="stylesheet" href="CSS/Screens CSS/Main.css" />
    <link rel="stylesheet" href="CSS/Normalize.css" />
    <link rel="shortcut icon" href="img/Logo.png" type="image/x-icon">
  </head>

  <body>
    <div class="login-container">
      <h2>C2C Interviews System</h2>
      <div class="img">
        <img src="img/Logo.png"
          alt="Logo"
          onerror="this.style.display='none'"
        />
      </div>
      <div class="input-group">
        <input type="text" id="searchId" placeholder="Enter ID" />
      </div>
      <button onclick="searchSheet()">Search</button>
      <br />
      <a
        target="_blank"
        style="
          color: black;
          text-decoration: none;
          text-align: center;
          font-size: larger;
        "
        href="mailto:c2c.bis.helwan@gmail.com"
        >Have a problem? Contact us</a
      >
      <p class="copyright">&copy; 2025 <span>C2C</span> All Right Reserved</p>
    </div>

    <div id="myModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <span class="modal-close-btn">&times;</span>
          <h2 id="modal-title">Modal Title</h2>
        </div>
        <div class="modal-body">
          <p id="modal-text">Some text in the Modal Body</p>

          <div id="modal-loader" class="loader" style="display: none"></div>

          <div id="modal-details" style="display: none"></div>
        </div>
        <div class="modal-footer">
          <div class="flex-btn">

            <a            
            id="modal-btn-confirm"
            class="modal-btn confirm"
            style="display: none; text-decoration: none; text-align:center;" href="https://forms.gle/Cpr5ksFT81bKhWTYA" target="_blank">Confirm</a>

            <button
            id="modal-btn-cancel"
            class="modal-btn cancel"
            style="display: none"
          >
            Cancel (إلغاء)
          </button>

          <button id="modal-btn-ok" class="modal-btn ok" style="display: none">
            OK
          </button>

        </div>
      </div>
    </div>

    <script>
      const webAppUrl =
        "https://script.google.com/macros/s/AKfycbxO1MRU5lJG91wyt4Tug4u26ZXPGRaanc8iU_2ow_YHjmGUZ-hqup6h7snf-fhGenDa/exec";

      const modal = document.getElementById("myModal");
      const modalTitle = document.getElementById("modal-title");
      const modalText = document.getElementById("modal-text");
      const modalLoader = document.getElementById("modal-loader");
      const modalDetails = document.getElementById("modal-details");
      const modalBtnConfirm = document.getElementById("modal-btn-confirm");
      const modalBtnCancel = document.getElementById("modal-btn-cancel");
      const modalBtnOk = document.getElementById("modal-btn-ok");
      const modalCloseBtn =
        document.getElementsByClassName("modal-close-btn")[0];

      let currentSearchData = {};

      function hideModal() {
        modal.style.display = "none";

        modalLoader.style.display = "none";
        modalText.style.display = "none";
        modalDetails.style.display = "none";
        modalBtnConfirm.style.display = "none";
        modalBtnCancel.style.display = "none";
        modalBtnOk.style.display = "none";

        modalText.textContent = "";
        modalDetails.innerHTML = "";

        currentSearchData = {};
      }

      function showModal(type, title, text, detailsHtml = null) {
        modalTitle.textContent = title;
        modalText.textContent = text;
        modalText.style.display = "block";

        if (type === "alert") {
          modalBtnOk.style.display = "inline-block";
        } else if (type === "loading") {
          modalLoader.style.display = "block";
        } else if (type === "confirmation") {
          modalDetails.innerHTML = detailsHtml;
          modalDetails.style.display = "block";
          modalBtnConfirm.style.display = "inline-block";
          modalBtnCancel.style.display = "inline-block";
        }

        modal.style.display = "block";
      }

      modalCloseBtn.onclick = hideModal;
      modalBtnCancel.onclick = hideModal;
      modalBtnOk.onclick = hideModal;

      window.onclick = function (event) {
        if (event.target == modal) {
          hideModal();
        }
      };

      async function searchSheet() {
        const searchId = String(
          document.getElementById("searchId").value.trim()
        );

        if (!searchId) {
          showModal("alert", "Warning", "Please enter an ID to search.");
          return;
        }

        showModal("loading", "Searching...", "Please wait");

        try {
          const testResponse = await fetch(webAppUrl + "?id=" + searchId, {
            method: "GET",
            headers: { Accept: "application/json" },
          });

          if (!testResponse.ok) {
            throw new Error(`HTTP error! status: ${testResponse.status}`);
          }

          const result = await testResponse.json();

          if (result.error) {
            throw new Error(
              result.error === "Not Found"
                ? "No matching ID found."
                : result.error
            );
          }

          currentSearchData = { id: searchId, result: result };

          hideModal();

          const detailsHtml = `
                  <strong>Full Name:</strong> ${result.fullName || "N/A"} <br>
                  <hr>
                  <strong>Day:</strong> ${result.day || "Not scheduled yet"} <br>
                  <strong>Time:</strong> ${result.time || "Not scheduled yet"} <br>
                  <strong>Room:</strong> ${result.room || "Not scheduled yet"} <br><br>
              `;

          showModal(
            "confirmation",
            "Interview Schedule",
            "Please confirm your attendance for this interview or request a change",
            detailsHtml
          );
        } catch (error) {

          console.error("Error:", error);
          hideModal();
          showModal(
            "alert",
            "Error",
            error.message || "An error occurred while processing your request."
          );
        }
      }
    </script>
  </body>
</html>

